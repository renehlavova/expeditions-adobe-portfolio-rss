name: Generate RSS feed

on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  generate_rss:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: "3.12"

      - name: Install pipx
        uses: CfirTsabari/actions-pipx@v1

      - name: Install poetry
        run: pipx install poetry

      - name: Install dependencies
        run: |
          poetry install --no-root

      - name: Generate RSS feed
        run: |
          poetry run python generate_rss_feed.py

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v3
        with:
          commit-message: "Generate RSS feed"
          title: "Generate RSS feed"
          body: "This PR was automatically generated by a GitHub Action to update the RSS feed."
          branch: rss-feed
          base: master
          labels: "rss-feed"
          reviewers: "renehlavova"
          assignees: "renehlavova"
          branch-suffix: timestamp
